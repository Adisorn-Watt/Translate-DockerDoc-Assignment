# USER

ไฟล์อ้างอิง Docker สำหรับคำแนะนำของ USER : <https://docs.docker.com/engine/reference/builder/#user/>

ถ้าเซอวิสสามารถทำงานโดยไม่ต้องมีสิทธิจะใช้ `USER` เพื่อเปลี่ยนไปยังผู้ใช้ที่ไม่ใช่ค่าเริ่มต้น
เริ่มจากการส้รางผู้ใช้และกลุ่มผู้ใช้ใน `Dockerfile` โดยการเขียน `RUN groupadd -r postgres && useradd --no-log-init -r -g postgres postgres`

#### พิจารณาถึง UID/GID

ผู้ใช้และกลุ่มผู้ใช้ต่างๆในอิมเมจได้รับการกำหนด UID / GID ที่ไม่ได้กำหนดไว้ซึ่งจะมีการกำหนด UID / GID“ ถัดไป” โดยไม่คำนึงถึงการสร้างอิมเมจใหม่ ดังนั้นหากสำคัญคุณควรกำหนด UID / GID ที่ชัดเจน

เนื่องจากมีบัคที่ยังไม่ได้รับการแก้ไขในการรับมือของเฟสของไฟล์ต่างๆใน Go archive/tar package การพยายามที่จะสร้างผู้ใช้กับ UID ที่เจาะจงและขนาดใหญ่ใน Docker Container จะทำให้หน่วยความจำทำงานหนักเพราะ `/var/log/faillog` ในชั้นของคอนเทนเนอร์จะเต็มไปด้วย NULL ตัวอักษร (\0) วิธีแก้ปัญหาคือใส่ flag `--no-log-init` ลงไปในตอนเพิ่มผู้ใช้ ระบบที่เป็น Debian/Ubuntu ไม่รองรับ flag นี้

หลีกเลี่ยงการติดตั้งหรือการใช้ `sudo` เพราะมันไม่สามารถคาดเดา TTY และ พฤติกรรมของการส่งต่อสัญญาณที่สามารถสร้างปัญหาได้
ถ้าคุณต้องการฟังก์ชั่นที่คล้ายกับ `sudo` เช่นการติดตั้ง daemon ที่ `root` แต่ทำงาน `non-root` ควรพิจารณาใช้ `"gosu"` แทน

สุดท้ายนี้เพื่อที่จะลดลำดับและความยุ่งยากหลีกเลี่ยงการสลับ `USER` ไปมาบ่อยๆ
